<VirtualHost *:80>
    ServerName fredzannarbor.com
    ServerAlias www.fredzannarbor.com

    ProxyPreserveHost On

    # Handle Streamlit's static files and core endpoints
    ProxyPass /_stcore http://127.0.0.1:8501/_stcore
    ProxyPassReverse /_stcore http://127.0.0.1:8501/_stcore

    # WebSocket handling
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://127.0.0.1:8501/$1" [P,L]

    # Main proxy
    ProxyPass / http://127.0.0.1:8501/
    ProxyPassReverse / http://127.0.0.1:8501/

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>